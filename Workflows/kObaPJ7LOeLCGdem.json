{
  "active": false,
  "connections": {
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "POST VENTA": {
      "main": [
        [
          {
            "node": "Enviar texto3",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "POST VENTA",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "POST VENTA",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Crear Registro": {
      "ai_tool": [
        [
          {
            "node": "POST VENTA",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Registro": {
      "ai_tool": [
        [
          {
            "node": "POST VENTA",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Registros": {
      "ai_tool": [
        [
          {
            "node": "POST VENTA",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Estructurar": {
      "main": [
        [
          {
            "node": "POST VENTA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Estructurar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "POST VENTA",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Asignador",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Orientadoras": {
      "ai_tool": [
        [
          {
            "node": "Asignador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Normalizar datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Asignador",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Escucha un nuevo registro": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalizar datos": {
      "main": [
        [
          {
            "node": "Asignador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Asignador": {
      "main": [
        [
          {
            "node": "Actualizar Orientadora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Orientadora": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        []
      ]
    }
  },
  "createdAt": "2025-08-08T01:56:08.522Z",
  "id": "kObaPJ7LOeLCGdem",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Registro Postventa",
  "nodes": [
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "mensaje"
            },
            {
              "fieldToAggregate": "whatsapp"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -2400,
        1632
      ],
      "id": "4483acb4-3444-40a0-b269-62d9d049f4df",
      "name": "Aggregate2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.mensaje }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=Eres un agente conversacional de la empresa \"Feliz con mi carrera\", un programa que acompa√±a a j√≥venes y familias a elegir la carrera universitaria m√°s adecuada y satisfactoria. Atiendes en WhatsApp, con un tono casual, amigable y estilo mexicano (usa emojis donde aplique).\n\nTu funci√≥n es:\n1. Responder preguntas frecuentes usando √∫nicamente la informaci√≥n institucional proporcionada. Jam√°s inventes ni asumas.\n2. Registrar a los alumnos que hayan adquirido un programa, siguiendo este flujo exacto y **preguntando siempre de una en una**. No avances a la siguiente pregunta si no has recibido ni registrado respuesta v√°lida de la anterior.\n\nüëÄ Siempre revisa el historial del chat antes de responder o seguir.\n\n---\n\nüßæ**FLUJO DE REGISTRO DE COMPRA**\n\nAntes de usar \"Crear Registro\", busca en la hoja si ya existe una fila con el mismo ID: `{{ $('Edit Fields2').item.json.chat_id }}`.\n- Si ya existe, no hagas nada y contin√∫a con las preguntas usando \"Actualizar Registro\".\n- Si no existe, usa \"Crear Registro\" para iniciar el registro del alumno.\n\nPrimero valida el comprobante de pago. S√≥lo si `comprobante_valido = true`, contin√∫a el proceso:\n\nP√≠dele al usuario que env√≠e su comprobante en formato imagen o PDF.\n\n1. Usa la herramienta **\"Crear Registro\"** para registrar:\n   - `ID`: `{{ $('Edit Fields2').item.json.chat_id }}`\n   - `Forma de pago`: `metodo`\n   - `Fecha compra`: `fecha`\n   - Luego pregunta: *¬øCu√°l es el nombre del programa que adquiriste?*\n     - Guarda en campo `PRODUCTO`.\n\n2. Usa **\"Actualizar Registro\"** con ID para guardar la info.\n\n---\n\nüìù**PREGUNTAS OBLIGATORIAS (una por una, en este orden):**\n\nPor cada pregunta:\n\n1. Espera la respuesta.\n2. Valida si aplica (email, tel√©fono, etc.).\n3. Usa la herramienta **\"Registros\"** para obtener los datos actuales del alumno por su `ID`.\n4. Combina el nuevo dato con los datos existentes (sin borrar nada).\n5. Usa la herramienta **\"Actualizar Registro\"** para guardar **toda la fila completa con el nuevo campo actualizado**.\n6. S√≥lo despu√©s de guardar correctamente, haz la siguiente pregunta.\n\nPreguntas:\n\n- ¬øCu√°l es el nombre del alumno? ‚Üí CAMPO: `Nombre Estudiante`\n- ¬øCu√°l es el email del alumno? ‚Üí CAMPO: `email alumno` *(validar formato)*\n- ¬øCu√°l es el n√∫mero del alumno? ‚Üí CAMPO: `Celular Alumno` *(validar tel√©fono)*\n- ¬øCu√°l es el nombre del padre o tutor? ‚Üí CAMPO: `Nombre Completo Tutor`\n- ¬øCu√°l es el celular del padre o tutor? ‚Üí CAMPO: `Cel tutor` *(validar tel√©fono)*\n- ¬øCu√°l es el nombre del colegio del alumno? ‚Üí CAMPO: `Colegio`\n- ¬øCu√°l es su idioma? ‚Üí CAMPO: `Idioma`\n- ¬øEn qu√© ciudad viven? ‚Üí CAMPO: `Ciudad`\n- ¬øNecesita empezar en una fecha distinta a la semana del {{ $json.FechaMaster }}? ¬øCu√°ndo? ‚Üí CAMPO: `Fecha Inicio`\n\n---\n\nüß©**PREGUNTAS EXTRA (una por una, al final):**\n\n10. ¬øQu√© a√±o est√° cursando? ‚Üí CAMPO: `A√±o Cursando` *(solo para resumen, no se guarda en sheet)*\n11. ¬øTiene alguna restricci√≥n de d√≠as u horarios para tomar sus sesiones? ‚Üí CAMPO: `Restricciones Horario` *(interno)*\n12. Si no recibiste \"Fecha Inicio\", vuelve a preguntarla. ‚Üí CAMPO: `Fecha Inicio`\n13. ¬øTiene alguna necesidad educativa especial o tema de salud emocional? Ej.: TDAH, ansiedad, etc. ‚Üí CAMPO: `Necesidad Especial` *(interno)*\n\n---\n\nüìå**RESUMEN FINAL (obligatorio):**\n\nRedacta un p√°rrafo claro y descriptivo combinando:\n\n- A√±o cursado\n- Necesidades educativas/emocionales\n- Restricciones de horarios\n- Otros detalles relevantes del alumno\n\nEjemplo:\n> \"3 a√±o de preparatoria. Est√° diagnosticada con TDA y ansiedad. Tiene terapia conductual y psiqui√°trica. Lunes y mi√©rcoles no puede de 6 a 8 pm.\"\n\nGuarda el texto en el campo `Notas` usando **\"Actualizar Registro\"**, asegur√°ndote de combinarlo con los datos actuales de la fila (usando la herramienta \"Registros\").\n\n---\n\n‚ö†Ô∏è**RESTRICCIONES IMPORTANTES**:\n\n- Nunca muestres ni reveles datos de otros registros.\n- Nunca avances si no tienes respuesta v√°lida.\n- Nunca inventes datos ni rellenes campos sin recibirlos.\n- Recuerda que la fecha actual es: `{{ $now }}`\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1712,
        1632
      ],
      "id": "2322435b-4368-4366-b5fc-057cb1bbe71b",
      "name": "POST VENTA",
      "retryOnFail": true,
      "maxTries": 5
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1920,
        1904
      ],
      "id": "326ac696-af82-416a-ac8d-803c7793ab06",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "a6T9FSulj0yWIirx",
          "name": "Converging"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "FelizBot",
        "remoteJid": "={{ $('Edit Fields2').item.json.chat_id }}",
        "messageText": "={{ $json.output.mensaje }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -1392,
        1616
      ],
      "id": "66181d0f-5e20-4ab4-b181-008b23e7aa8f",
      "name": "Enviar texto3",
      "credentials": {
        "evolutionApi": {
          "id": "PmLHlyqZKQXgGIBQ",
          "name": "EnriqueAPI"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"mensaje\": \"Mensaje del al usuario\"\n}",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -1168,
        1840
      ],
      "id": "7e84bc32-c81e-4a13-9319-32750f16290b",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -976,
        2000
      ],
      "id": "0b023acc-ebcc-49f6-85fb-f93ea1c16733",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "a6T9FSulj0yWIirx",
          "name": "Converging"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4",
          "mode": "list",
          "cachedResultName": "Vendidos Prueba",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1566833164,
          "mode": "list",
          "cachedResultName": "29 de Julio",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit#gid=1566833164"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID": "={{ $('Edit Fields2').item.json.chat_id }}",
            "Forma de Pago": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Forma_de_Pago', ``, 'string') }}",
            "PRODUCTO": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('PRODUCTO', ``, 'string') }}",
            "Fecha Compra": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Fecha_Compra', ``, 'string') }}",
            "Nombre Estudiante": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nombre_Estudiante', ``, 'string') }}",
            "email alumno": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('email_alumno', ``, 'string') }}",
            "Celular Alumno": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Celular_Alumno', ``, 'string') }}",
            "Idioma": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Idioma', ``, 'string') }}",
            "Colegio": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Colegio', ``, 'string') }}",
            "Ciudad": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Ciudad', ``, 'string') }}",
            "Fecha Inicio": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Fecha_Inicio', ``, 'string') }}",
            "Notas": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Notas', ``, 'string') }}",
            "Cel tutor": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Cel_tutor', ``, 'string') }}",
            "Nombre Completo Tutor": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nombre_Completo_Tutor', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Forma de Pago",
              "displayName": "Forma de Pago",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "PRODUCTO",
              "displayName": "PRODUCTO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Fecha Compra",
              "displayName": "Fecha Compra",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nombre Estudiante",
              "displayName": "Nombre Estudiante",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email alumno",
              "displayName": "email alumno",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Celular Alumno",
              "displayName": "Celular Alumno",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nombre Completo Tutor",
              "displayName": "Nombre Completo Tutor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Cel tutor",
              "displayName": "Cel tutor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Idioma",
              "displayName": "Idioma",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Colegio",
              "displayName": "Colegio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Ciudad",
              "displayName": "Ciudad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Fecha Inicio",
              "displayName": "Fecha Inicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Notas",
              "displayName": "Notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Orientadora",
              "displayName": "Orientadora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        -1504,
        1936
      ],
      "id": "da019db1-4c9b-4d60-ae4c-68eab6a809f9",
      "name": "Crear Registro",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "UUAnITIItWHLyMP6",
          "name": "ApiGoogleEquipo"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4",
          "mode": "list",
          "cachedResultName": "Vendidos Prueba",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1566833164,
          "mode": "list",
          "cachedResultName": "29 de Julio",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit#gid=1566833164"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID": "={{ $('Edit Fields2').item.json.chat_id }}",
            "Forma de Pago": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Forma_de_Pago', ``, 'string') }}",
            "PRODUCTO": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('PRODUCTO', ``, 'string') }}",
            "Fecha Compra": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Fecha_Compra', ``, 'string') }}",
            "Nombre Estudiante": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nombre_Estudiante', ``, 'string') }}",
            "email alumno": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('email_alumno', ``, 'string') }}",
            "Celular Alumno": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Celular_Alumno', ``, 'string') }}",
            "Idioma": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Idioma', ``, 'string') }}",
            "Colegio": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Colegio', ``, 'string') }}",
            "Ciudad": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Ciudad', ``, 'string') }}",
            "Fecha Inicio": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Fecha_Inicio', ``, 'string') }}",
            "Notas": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Notas', ``, 'string') }}",
            "row_number": 0,
            "Cel tutor": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Cel_tutor', ``, 'string') }}",
            "Nombre Completo Tutor": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nombre_Completo_Tutor', ``, 'string') }}"
          },
          "matchingColumns": [
            "ID"
          ],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Forma de Pago",
              "displayName": "Forma de Pago",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "PRODUCTO",
              "displayName": "PRODUCTO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Fecha Compra",
              "displayName": "Fecha Compra",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nombre Estudiante",
              "displayName": "Nombre Estudiante",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email alumno",
              "displayName": "email alumno",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Celular Alumno",
              "displayName": "Celular Alumno",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nombre Completo Tutor",
              "displayName": "Nombre Completo Tutor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Cel tutor",
              "displayName": "Cel tutor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Idioma",
              "displayName": "Idioma",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Colegio",
              "displayName": "Colegio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Ciudad",
              "displayName": "Ciudad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Fecha Inicio",
              "displayName": "Fecha Inicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Notas",
              "displayName": "Notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "OV",
              "displayName": "OV",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Columna 1",
              "displayName": "Columna 1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Columna 2",
              "displayName": "Columna 2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        -1712,
        2032
      ],
      "id": "d5cbbde7-ff42-48f2-9956-40084726c914",
      "name": "Actualizar Registro",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "UUAnITIItWHLyMP6",
          "name": "ApiGoogleEquipo"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4",
          "mode": "list",
          "cachedResultName": "Vendidos Prueba",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1566833164,
          "mode": "list",
          "cachedResultName": "29 de Julio",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit#gid=1566833164"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        -1600,
        2016
      ],
      "id": "acb5ac4b-7fdd-4a7b-9bd7-4971ec5513b6",
      "name": "Registros",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "UUAnITIItWHLyMP6",
          "name": "ApiGoogleEquipo"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d4a268b3-a057-459f-89cd-f8893b1b0f7d",
              "name": "mensaje",
              "value": "={{ $('Aggregate2').item.json.mensaje[0] }}",
              "type": "string"
            },
            {
              "id": "460e2f62-e56c-4263-a5d7-00e0ff3be590",
              "name": "id_usuario",
              "value": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "91fc5a29-230e-475c-a11a-4bf7a9b01b30",
              "name": "FechaMaster",
              "value": "={{ $json.FechaMasterClass }}",
              "type": "string"
            },
            {
              "id": "85333985-56eb-4efa-902d-f549d738707f",
              "name": "sessionId",
              "value": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1984,
        1632
      ],
      "id": "b3043035-dba1-477b-8b13-7118ef2d039b",
      "name": "Estructurar"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1TfaM1ttI3di1u6vCDY11gMf2HAbeq9tHXwG1RFJeH1I",
          "mode": "list",
          "cachedResultName": "Admin Enrique",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1TfaM1ttI3di1u6vCDY11gMf2HAbeq9tHXwG1RFJeH1I/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1610359296,
          "mode": "list",
          "cachedResultName": "Variables",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1TfaM1ttI3di1u6vCDY11gMf2HAbeq9tHXwG1RFJeH1I/edit#gid=1610359296"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2192,
        1632
      ],
      "id": "57f9e34d-ed38-453b-9789-22ad6eb370e7",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "UUAnITIItWHLyMP6",
          "name": "ApiGoogleEquipo"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -1824,
        1984
      ],
      "id": "30061f96-a826-4cf1-a562-13cab2cb4ad4",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "74h0q7M5LKQy0D94",
          "name": "Pruebas"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -3856,
        1872
      ],
      "id": "879b2373-d343-4539-8f76-2a428753499f",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "a6T9FSulj0yWIirx",
          "name": "Converging"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1sS1g_kyp-zlObmFfQ2gx65Ds7eRsGL4QNQJp5wwY94Q",
          "mode": "list",
          "cachedResultName": "Tabla de orientadoras",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sS1g_kyp-zlObmFfQ2gx65Ds7eRsGL4QNQJp5wwY94Q/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 761238751,
          "mode": "list",
          "cachedResultName": "Caracter√≠sticas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sS1g_kyp-zlObmFfQ2gx65Ds7eRsGL4QNQJp5wwY94Q/edit#gid=761238751"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        -3728,
        1920
      ],
      "id": "920c1153-4d58-4165-a172-e6b3b9d67ac4",
      "name": "Orientadoras",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "UUAnITIItWHLyMP6",
          "name": "ApiGoogleEquipo"
        }
      }
    },
    {
      "parameters": {
        "batchSize": "=1",
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -4224,
        1632
      ],
      "id": "99f33c3d-f7c8-49f9-9b26-4d3c4752d12e",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"orientadora\": \"nombre\",\n  \"razon\": \"explicaci√≥n breve\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -3600,
        1872
      ],
      "id": "315804c4-ccf9-4974-87d3-add8f9f3b1c7",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "documentId": {
          "__rl": true,
          "value": "1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4",
          "mode": "list",
          "cachedResultName": "Vendidos Prueba",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1566833164,
          "mode": "list",
          "cachedResultName": "29 de Julio",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit#gid=1566833164"
        },
        "event": "rowUpdate",
        "options": {
          "columnsToWatch": [
            "Notas"
          ]
        }
      },
      "type": "n8n-nodes-base.googleSheetsTrigger",
      "typeVersion": 1,
      "position": [
        -4432,
        1632
      ],
      "id": "df5c1402-2309-4903-bc6b-02c35fdeb094",
      "name": "Escucha un nuevo registro",
      "credentials": {
        "googleSheetsTriggerOAuth2Api": {
          "id": "1ITrO0tTQ2CGCA1P",
          "name": "ApiEquipo"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "afc095a8-6e51-4f2b-9929-af9d8f991f8c",
              "name": "Resumen",
              "value": "={{ $json.Notas }}",
              "type": "string"
            },
            {
              "id": "42cf031b-2a29-4e2d-9ea0-2bb72031d0a6",
              "name": "Fecha Inicio",
              "value": "={{ $json['Fecha Inicio'] }}",
              "type": "string"
            },
            {
              "id": "7bf18232-5435-43ad-a48f-4b1e54fe9bb7",
              "name": "Idioma",
              "value": "={{ $json.Idioma }}",
              "type": "string"
            },
            {
              "id": "91f1cb6e-16d1-4ed6-9de9-8599db4dabbd",
              "name": "ID",
              "value": "={{ $json.ID }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4000,
        1664
      ],
      "id": "25225409-df10-4d89-b9cd-646eee71984e",
      "name": "Normalizar datos"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.Resumen }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=Recibir√°s un resumen de un alumno. El idioma es: {{ $json.Idioma }}.\nCon base en ese resumen, revisa la tabla de orientadoras y elige a la m√°s adecuada para atenderlo.\nDevuelve √∫nicamente un JSON con este formato:\n\n{\n  \"orientadora\": \"nombre\",\n  \"razon\": \"explicaci√≥n breve\"\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -3808,
        1648
      ],
      "id": "e8589037-66b2-4729-9e57-0af37700b5a4",
      "name": "Asignador"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4",
          "mode": "list",
          "cachedResultName": "Vendidos Prueba",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1566833164,
          "mode": "list",
          "cachedResultName": "29 de Julio",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4/edit#gid=1566833164"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID": "={{ $('Normalizar datos').item.json.ID }}",
            "Orientadora": "={{ $json.output.orientadora }}"
          },
          "matchingColumns": [
            "ID"
          ],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Forma de Pago",
              "displayName": "Forma de Pago",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "PRODUCTO",
              "displayName": "PRODUCTO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Fecha Compra",
              "displayName": "Fecha Compra",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre Estudiante",
              "displayName": "Nombre Estudiante",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email alumno",
              "displayName": "email alumno",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Celular Alumno",
              "displayName": "Celular Alumno",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre Completo Tutor",
              "displayName": "Nombre Completo Tutor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Cel tutor",
              "displayName": "Cel tutor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Idioma",
              "displayName": "Idioma",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Colegio",
              "displayName": "Colegio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Ciudad",
              "displayName": "Ciudad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Fecha Inicio",
              "displayName": "Fecha Inicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Notas",
              "displayName": "Notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Orientadora",
              "displayName": "Orientadora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3456,
        1648
      ],
      "id": "dba251ae-7ae2-4246-a029-29bf4d41f896",
      "name": "Actualizar Orientadora",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "UUAnITIItWHLyMP6",
          "name": "ApiGoogleEquipo"
        }
      }
    },
    {
      "parameters": {
        "content": "# Coloca aqui el flujo",
        "height": 976,
        "width": 3552,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4496,
        176
      ],
      "typeVersion": 1,
      "id": "12d7deaf-c0b9-4853-9f14-f9bfa935e479",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "cc85574d-077a-4ad2-87f5-ac7426c97e1d",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -4304,
        576
      ],
      "id": "419125a2-ac61-4d49-9f73-8be57e7c0def",
      "name": "Webhook",
      "webhookId": "cc85574d-077a-4ad2-87f5-ac7426c97e1d"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-08-08T01:56:08.527Z",
      "updatedAt": "2025-08-08T01:56:08.527Z",
      "role": "workflow:owner",
      "workflowId": "kObaPJ7LOeLCGdem",
      "projectId": "zJAKCKeG7Ef7sO6E"
    }
  ],
  "staticData": {
    "node:Google Sheets Trigger": {
      "documentId": "1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4",
      "sheetId": 1566833164,
      "lastRevision": 234,
      "lastRevisionLink": "https://docs.google.com/spreadsheets/export?id=1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4&revision=234&exportFormat=xlsx"
    },
    "node:Escucha un nuevo registro": {
      "documentId": "1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4",
      "sheetId": 1566833164,
      "lastRevision": 239,
      "lastRevisionLink": "https://docs.google.com/spreadsheets/export?id=1zuy3rT5LHo3BMA4ycLjT7jWn62VS7rcxW7sROztthQ4&revision=239&exportFormat=xlsx"
    }
  },
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2025-09-19T00:19:39.000Z",
  "versionId": "ab237a47-03c8-4227-950e-ed850405618d"
}